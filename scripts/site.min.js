var addemails,convertgist,convertimg,find,load,markup,posts,replaceall,routing,sanitize,show,time_zones,vglize;posts=[],time_zones={"-1000":["HAST",!1],"-0900":["AKST","HADT"],"-0800":["PST","AKDT"],"-0700":["MST","PDT"],"-0600":["CST","MDT"],"-0500":["EST","CDT"],"-0400":["AST","EDT"],"-0330":["NST",!1],"-0300":[!1,"ADT"],"-0230":[!1,"NDT"]},moment.meridiem=function(t){return["a.m.","p.m."][Math.floor(t/12)]},convertimg=function(t){var e,n,r,o;return t=$(t),o=t.attr("src"),e=o.match(/\/w([0-9]+)-h([0-9]+)-/),null!=e?(console.dir(e),r=e[2]/e[1],console.log(r),n=$(document.createElement("div")),n.css({width:"100%",backgroundImage:"url("+o+")",backgroundSize:"cover",backgroundRepeat:"no-repeat",backgroundPosition:"50% 50%"}),t.replaceWith(n),$(window).resize(function(){return n.css("height",""+n.width()*r+"px")}),$(window).trigger("resize")):void 0},convertgist=function(t){var e,n;return t=$(t),e=t.attr("alt"),n=t.attr("src").match(/^gist\:([0-9a-z]+)$/i),null!=n?load("https://api.github.com/gists/"+n[1],"jsonp",function(r){var o,s;return null!=r.data.files?(s=$(document.createElement("pre")),o=sanitize(r.data.files[e].content),/\.rpf$/.test(e)&&(o=vglize(o)),s.html(o),t.parent().replaceWith(s)):(t.parent().css("margin-left","2rem"),t.replaceWith('<a href="https://gist.github.com/'+n[1]+"#file-"+e.replace(/\./g,"-")+'"><code>'+e+"</code></a>"))}):void 0},sanitize=function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},replaceall=function(t,e){var n,r,o;for(r=0,o=e.length;o>r;r++)n=e[r],t=t.replace(n[0],n[1]);return t},vglize=function(t){return replaceall(" "+t+" ",[[/(\W)([A-Z_]+)(\W)/g,'$1<span class="vgl-keyword">$2</span>$3'],[/^\s/,""],[/\s$/,""]])},markup=function(t){var e;return null==(e=window.Converter)&&(window.Converter=new Markdown.Converter),window.Converter.makeHtml(t)},load=function(t,e,n){return $.ajax({url:t,dataType:e,error:function(){return console.dir(arguments)},success:function(t){return n(t)}})},find=function(t){return _.find(posts,function(e){return e.slug===t})},show=function(t){var e,n,r,o,s;return t.html?(console.dir("using cached html for "+t.slug),n=$("#post"),n.empty(),r=t.moment.format("MMMM D, YYYY"),o=t.moment.format("h:mm a"),s=time_zones[t.moment.format("ZZ")][t.moment.isDST()?1:0],s||(s=t.moment.format("ZZ")),e=$(document.createElement("article")),e.append("<header><h1>"+t.title+"</h1><h2>"+r+" @ "+o+" "+s+"</h2></header>"),e.append("<section>"+t.html+"</section>"),$("section > h1",e).first().remove(),n.append(e),$('img[src$="#stretch-me"]',n).each(function(){return convertimg(this)}),$('img[src^="gist:"]',n).each(function(){return convertgist(this)}),addemails(n)):(console.dir("loading posts/"+t.file),load("posts/"+t.file,"text",function(e){var n;return n=_.indexOf(posts,t),posts[n].html=/\.md$/.test(t.file)?markup(e):e,console.dir("markdown -> html saved in cache"),show(posts[n])}))},routing=function(t){var e;return e=new Davis(function(){var e,n,r,o,s;for(this.configure(function(t){return t.generateRequestOnPageLoad=!0,t.handleRouteNotFound=!0}),this.bind("routeNotFound",function(t){return t.redirect("/")}),o=t.routes,s=[],n=0,r=o.length;r>n;n++)e=o[n],s.push(this.get(e.pattern,t.fn[e.fn]));return s})},addemails=function(t){return null==t&&(t=$("body")),$('a[href="#email"]').attr("href","mailto:me+website@iancooper.name")},$(function(){return addemails(),$("nav > header > h1").css("cursor","pointer").click(function(t){return t.preventDefault(),self.location.href="http://iancooper.name/"}),load("posts/index.json","json",function(t){var e,n,r,o,s,a,i,l,u;for(posts=[],u=t.posts,a=0,l=u.length;l>a;a++)s=u[a],s.moment=moment(s.date,"YYYY-MM-DDTHH:mmZZ"),s.date=s.moment.format("D MMM YYYY"),s.dateValue=s.moment.valueOf(),s.html=null,posts.push(s);for(posts.sort(function(t,e){return e.dateValue-t.dateValue}),r=$("#posts").attr("data-max-recent"),n=posts.length>r?r:posts.length,o=moment(),e=i=0;n>=0?n>i:i>n;e=n>=0?++i:--i)"published"===posts[e].status&&o>=posts[e].moment?$("#posts").append('<li><a href="'+posts[e].slug+'">'+posts[e].title+' <span class="date">'+posts[e].date+"</span></a></li>"):e--;return routing({fn:{latest:function(t){var n,r,s;for(o=moment(),s=[],e=n=0,r=posts.length;r>=0?r>=n:n>=r;e=r>=0?++n:--n){if("published"===posts[e].status&&o>=posts[e].moment){t.redirect("/"+posts[e].slug);break}s.push(void 0)}return s},selected:function(t){return s=find(t.params.post),null!=s?show(s):t.redirect("/latest")}},routes:[{pattern:"/",fn:"latest"},{pattern:"/latest",fn:"latest"},{pattern:"latest",fn:"latest"},{pattern:"/:post",fn:"selected"},{pattern:":post",fn:"selected"}]})})});